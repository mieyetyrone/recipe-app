<!DOCTYPE html>
<html>
	<head>
		<title>ADD RECIPE</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
	</head>
	<body>
		<div class="container pt-3">
			<button onclick="window.location.assign('index.html')" class="btn btn-outline-primary">Home</button>
			<h1>Add recipe below</h1>
			<div class="container p-3 my-3 border bg-light text-dark">
				<div class="form-group">
					<label for="recipeTitle"><h5>Recipe Title</h5></label>
					<br>
					<input type="text" id="recipeTitle" class="form-control" placeholder="e.g. Jolof rice" required><br>
				</div>
			</div>
			<div class="container p-3 my-3 border bg-light text-dark">
				<div class="form-group">
					<label for="lastAddedIngredient"><h5>Add Ingredients</h5></label>
					<br>
					<input type="text" id="lastAddedIngredient" class="form-control" placeholder="e.g. Rice">
				</div>
				<br>
				<p id="addedIngredients" style="color: blue;"></p>
				<button onclick="addIngredient()" class="btn btn-outline-success">Add ingredient</button>
				<br>
			</div>
			<div class="container p-3 my-3 border bg-light text-dark">
				<div class="form-group">
					<label for="prepSteps"><h5>Preparation steps</h5></label>
					<br>
					<textarea id="prepSteps" class="form-control" rows="5" placeholder="List the preparation steps" required></textarea>
					<br>
				</div>
			</div>
			<button onclick="addRecipe()" class="btn btn-outline-success" style="margin:5px 10px">Add recipe</button>
			<button onclick="cancel()" class="btn btn-outline-dark" style="margin:5px 10px">Cancel</button>
		</div>
		<script>
			let recipeTitle = "";
			let ingredients = [];//Changed to let to enable reassignment
			let preparationSteps = "";

			function addIngredient(){
				let lastAdded = document.getElementById("lastAddedIngredient").value;
				lastAdded = lastAdded.trim();
				if(lastAdded==="" || !validateText(lastAdded)){
					alert("The last added ingredient is not valid");
				}
				else{
					ingredients.push(lastAdded);
					document.getElementById("addedIngredients").innerHTML = ingredients;
				}
				document.getElementById("lastAddedIngredient").value = "";
			}
			function validateText(txt){
				let validText = /^[A-Za-z\s]+$/;
				if(txt.match(validText)){
					return true;
				}
				else{
					return false;
				}
			}
			function validateInput(){
				let error = "";
				if(recipeTitle==="" || !validateText(recipeTitle)){
					error += "The Recipe Title is not valid\n";
				}
				if(ingredients.length===0){
					error += "Please insert the ingredients\n";
				}
				if(preparationSteps===""){
					error += "Please fill the Preparation Steps";
				}
				if(error!==""){
					alert(error);
					return false;
				}
				else{
					return true;
				}
			}
			function addRecipe(){
				recipeTitle = document.getElementById("recipeTitle").value;
				recipeTitle = recipeTitle.trim();
				preparationSteps = document.getElementById("prepSteps").value;
				preparationSteps = preparationSteps.trim();
				if(validateInput()){
					const myRecipeDB = sessionStorage.getItem("recipeDB");
					if(myRecipeDB === null){
						sessionStorage.setItem("recipeDB", recipeTitle + ":" + ingredients + ":" + preparationSteps);
					}
					/ *I decided to store not just the recipe title but also ingredients and preparation steps. 
					It just seems logical to me even though the current app does not require the ingredients and preparation step.
					A future solution might need those information */ 
					else{
						let myRecipes = sessionStorage.getItem("recipeDB");
						myRecipes = myRecipes + ";" + recipeTitle + ":" + ingredients + ":" + preparationSteps;
						sessionStorage.setItem("recipeDB", myRecipes);
					}
					document.getElementById("recipeTitle").value = "";
					document.getElementById("prepSteps").value = "";
					document.getElementById("addedIngredients").innerHTML = "";
					ingredients = [];//Fix for retaining previously stored values
					alert(recipeTitle + " has been added to the recipe list");
				}
			}
			function cancel(){
				recipeTitle = "";
				ingredients = [];
				preparationSteps = "";
				document.getElementById("recipeTitle").value = "";
				document.getElementById("prepSteps").value = "";
				document.getElementById("addedIngredients").innerHTML = "";
			}
		</script>
	</body>
</html>
