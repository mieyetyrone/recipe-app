<!DOCTYPE html>
<html>
	<head>
		<title>ADD RECIPE</title>
	</head>
	<body>
		<button onclick="window.location.assign('index.html')" style="margin:5px 10px">Home</button>
		<h1>Add recipe below</h1>
		<label for="recipeTitle" style="margin:5px 10px">Recipe Title</label>
		<br>
		<input type="text" id="recipeTitle" style="margin:10px" placeholder="e.g. Jolof rice" required><br>
		<label for="lastAddedIngredient" style="margin:5px 10px">Add Ingredients</label>
		<br>
		<input type="text" id="lastAddedIngredient" style="margin:10px" placeholder="e.g. Rice">
		<br>
		<p id="addedIngredients" style="margin:5px 10px; color: blue;"></p>
		<button onclick="addIngredient()" style="margin:5px 10px">Add ingredient</button>
		<br>
		<label for="prepSteps" style="margin:5px 10px">Preparation steps</label>
		<br>
		<textarea id="prepSteps" style="margin:10px" rows="5" cols="50" placeholder="List the preparation steps" required></textarea>
		<br>
		<button onclick="addRecipe()" style="margin:5px 10px">Add recipe</button>
		<button onclick="cancel()" style="margin:5px 10px">Cancel</button>	
		<script>
			let recipeTitle = "";
			let ingredients = [];//Changed to let to enable reassignment
			let preparationSteps = "";

			function addIngredient(){
				let lastAdded = document.getElementById("lastAddedIngredient").value;
				lastAdded = lastAdded.trim();
				if(lastAdded==="" || !validateText(lastAdded)){
					alert("The last added ingredient is not valid");
				}
				else{
					ingredients.push(lastAdded);
					document.getElementById("addedIngredients").innerHTML = ingredients;
				}
				document.getElementById("lastAddedIngredient").value = "";
			}
			function validateText(txt){
				let validText = /^[A-Za-z\s]+$/;
				if(txt.match(validText)){
					return true;
				}
				else{
					return false;
				}
			}
			function validateInput(){
				let error = "";
				if(recipeTitle==="" || !validateText(recipeTitle)){
					error += "The Recipe Title is not valid\n";
				}
				if(ingredients.length===0){
					error += "Please insert the ingredients\n";
				}
				if(preparationSteps===""){
					error += "Please fill the Preparation Steps";
				}
				if(error!==""){
					alert(error);
					return false;
				}
				else{
					return true;
				}
			}
			function addRecipe(){
				recipeTitle = document.getElementById("recipeTitle").value;
				recipeTitle = recipeTitle.trim();
				preparationSteps = document.getElementById("prepSteps").value;
				preparationSteps = preparationSteps.trim();
				if(validateInput()){
					const myRecipeDB = sessionStorage.getItem("recipeDB");
					if(myRecipeDB === null){
						sessionStorage.setItem("recipeDB", recipeTitle + ":" + ingredients + ":" + preparationSteps);
					}
					else{
						let myRecipes = sessionStorage.getItem("recipeDB");
						myRecipes = myRecipes + ";" + recipeTitle + ":" + ingredients + ":" + preparationSteps;
						sessionStorage.setItem("recipeDB", myRecipes);
					}
					document.getElementById("recipeTitle").value = "";
					document.getElementById("prepSteps").value = "";
					document.getElementById("addedIngredients").innerHTML = "";
					alert(recipeTitle + " has been added to the recipe list");
				}
			}
			function cancel(){
				recipeTitle = "";
				ingredients = [];
				preparationSteps = "";
				document.getElementById("recipeTitle").value = "";
				document.getElementById("prepSteps").value = "";
				document.getElementById("addedIngredients").innerHTML = "";
			}
		</script>
	</body>
</html>
